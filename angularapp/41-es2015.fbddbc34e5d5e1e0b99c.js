(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{aElb:function(t,e,n){"use strict";n.r(e);var r=n("ofXK"),s=n("mrSG"),i=n("4ZJM"),o=n("AytR"),a=n("PSD3"),u=n.n(a),c=n("fXoL"),d=n("cxbk"),h=n("tk/3"),l=n("LRne"),p=n("tyNb");const b=d.a.apiUrl;let f=(()=>{class t{constructor(t,e){this.http=t,this.router=e}buildService(){return Object(s.a)(this,void 0,void 0,(function*(){return this.token=localStorage.getItem("token")||void 0,this.token?(this.headers=new h.c({Authorization:"Bearer "+this.token}),!0):(this.router.navigateByUrl("/login"),!1)}))}getPuntosInteres(){return this.http.get(`${b}/puntos-interes`)}postPuntosInteres(t){return this.buildService().then(t=>{if(!t)return Object(l.a)({ok:!1})}),this.http.post(`${b}/puntos-interes`,t,{headers:this.headers})}putPuntosInteres(t){return this.buildService().then(t=>{if(!t)return Object(l.a)({ok:!1})}),this.http.put(`${b}/puntos-interes/${t.Id}`,t,{headers:this.headers})}deletePuntosInteres(t){return Object(s.a)(this,void 0,void 0,(function*(){return(yield this.buildService())?new Promise(e=>{this.http.delete(`${b}/puntos-interes/${t}`,{headers:this.headers}).subscribe(t=>{e(t.ok)})}):Promise.resolve(!1)}))}existsPunto(t,e){return new Promise(n=>{this.getPuntosInteres().subscribe(r=>{const s=r.find(n=>n.Longitud===t&&n.Latitud===e);n(void 0!==s)})})}}return t.\u0275fac=function(e){return new(e||t)(c.bc(h.a),c.bc(p.b))},t.\u0275prov=c.Ob({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),v=(()=>{class t{constructor(t){this.puntosService=t,this.puntosInteres=[],this.currentMarkers=[]}ngAfterViewInit(){i.accessToken=o.a.mapboxToken,this.mapa=new i.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[-74.3451602,4.8154681],zoom:15}),this.mapa.on("load",()=>{this.loadPuntosInteres()}),this.mapa.on("click",t=>Object(s.a)(this,void 0,void 0,(function*(){const{lng:e,lat:n}=t.lngLat;this.processMarker(e,n)})))}ngOnInit(){}loadPuntosInteres(){u.a.fire({title:"Espere por favor",text:"Cargando informaci\xf3n",icon:"info",allowOutsideClick:!1}),u.a.showLoading(),this.puntosService.getPuntosInteres().subscribe(t=>{this.puntosInteres=t,this.addMarkersToMap(),u.a.close()})}addMarkersToMap(){this.currentMarkers=[],this.puntosInteres.forEach(t=>{const e=(new i.Marker).setLngLat([t.Longitud,t.Latitud]).addTo(this.mapa);this.currentMarkers.push(e),e.getElement().addEventListener("click",()=>{setTimeout(()=>{this.processMarker(t.Longitud,t.Latitud,t.Descripcion)},10)}),e._element.addEventListener("mouseenter",()=>{e._element.style.cursor="pointer"})})}processMarker(t,e,n=""){return Object(s.a)(this,void 0,void 0,(function*(){u.a.fire({title:(""===n?"Crear":"Modificar")+" punto de inter\xe9s",text:"Ingresa una descripci\xf3n",input:"text",inputValue:n,showCancelButton:""!==n,confirmButtonText:""===n?"Crear":"Actualizar",cancelButtonColor:"#d33",cancelButtonText:"Eliminar",showCloseButton:!0,inputValidator:t=>{if(!t)return"Necesitas escribir algo!"}}).then(r=>{if(r.value)if(""===n)this.puntosService.postPuntosInteres({Descripcion:r.value,Latitud:e,Longitud:t}).subscribe(t=>{!0===t.ok&&this.loadPuntosInteres()});else{const n=this.puntosInteres.find(n=>n.Longitud===t&&n.Latitud===e);n.Descripcion=r.value,this.puntosService.putPuntosInteres(n).subscribe(t=>{!0===t.ok&&this.loadPuntosInteres()})}else if("cancel"===r.dismiss.toString()){const{Id:n}=this.puntosInteres.find(n=>n.Longitud===t&&n.Latitud===e);this.openConfirmAlert(n)}})}))}openConfirmAlert(t){u.a.fire({title:"\xbfEst\xe1s seguro?",text:"No podr\xe1s revertir la acci\xf3n",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminar"}).then(e=>Object(s.a)(this,void 0,void 0,(function*(){e.value&&(this.eliminarCurrentMarkers(),(yield this.puntosService.deletePuntosInteres(t))&&this.loadPuntosInteres())})))}eliminarCurrentMarkers(){for(let t=this.currentMarkers.length-1;t>=0;t--)this.currentMarkers[t]&&this.currentMarkers[t].remove()}}return t.\u0275fac=function(e){return new(e||t)(c.Sb(f))},t.\u0275cmp=c.Mb({type:t,selectors:[["app-puntos-interes"]],decls:10,vars:0,consts:[["id","main-header",1,"py-2","bg-info","text-white"],[1,"container"],[1,"row"],[1,"col-md-6"],[1,"container","my-3"],["id","map"]],template:function(t,e){1&t&&(c.Xb(0,"header",0),c.Xb(1,"div",1),c.Xb(2,"div",2),c.Xb(3,"div",3),c.Xb(4,"h1"),c.uc(5," Puntos de interes "),c.Wb(),c.Wb(),c.Wb(),c.Wb(),c.Wb(),c.Tb(6,"br"),c.Tb(7,"br"),c.Xb(8,"div",4),c.Tb(9,"div",5),c.Wb())},styles:["#map[_ngcontent-%COMP%]{width:100%;height:500px}"]}),t})();var m=n("iTUp");n.d(e,"PuntosInteresModule",(function(){return k}));let k=(()=>{class t{}return t.\u0275mod=c.Qb({type:t}),t.\u0275inj=c.Pb({factory:function(e){return new(e||t)},imports:[[r.b,m.a,p.d.forChild([{path:"",component:v}])]]}),t})()}}]);