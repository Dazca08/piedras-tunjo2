function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var n=[],r=!0,o=!1,a=void 0;try{for(var i,s=t[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!e||n.length!==e);r=!0);}catch(c){o=!0,a=c}finally{try{r||null==s.return||s.return()}finally{if(o)throw a}}return n}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{"u/OU":function(t,e,n){"use strict";n.r(e);var r=n("ofXK"),o=n("tyNb"),a=n("mrSG"),i=n("4ZJM"),s=n("AytR"),c=n("PSD3"),u=n.n(c),l=n("fXoL"),d=n("bJsm"),b=n("vDOo"),m=n("VngK"),f=n("3Pt+");function p(t,e){1&t&&(l.ac(0,"span"),l.Dc(1," El nombre de la ruta es requerido "),l.Zb())}function h(t,e){1&t&&l.Wb(0,"i",41)}function g(t,e){1&t&&l.Wb(0,"i",42)}var v,y=((v=function(){function t(e,n,r,o){_classCallCheck(this,t),this.puntosIntService=e,this.geometryService=n,this.recorridosService=r,this.router=o,this.nombre="",this.tiempoEstimado=10,this.defineRuta=!0,this.verPtsInteres=!1,this.isPuntoInteres=!1,this.isPuntoControl=!1,this.puntosControl=[],this.existsPuntoCtrl=!1,this.markersPtsInteres=[],this.markersPtsControl=[],this.puntosInteres=[],this.ptsInteresRuta=[],this.geojson={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:[]}}]}}return _createClass(t,[{key:"ngOnInit",value:function(){}},{key:"ngAfterViewInit",value:function(){var t=this;i.accessToken=s.a.mapboxToken,this.mapa=new i.Map({container:"map-recorrido",style:"mapbox://styles/mapbox/streets-v11",center:[-74.3451602,4.8154681],zoom:15}),this.mapa.on("load",(function(){t.mapa.addSource("line",{type:"geojson",data:t.geojson}),t.mapa.addLayer({id:"line-animation",type:"line",source:"line",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#ed6498","line-width":5,"line-opacity":.8}})})),this.mapa.on("click",(function(e){var n=e.lngLat,r=n.lng,o=n.lat;t.defineRuta?t.isPuntoInteres||t.isPuntoControl?t.isPuntoInteres=t.isPuntoControl=!1:t.agregarCoordenada(r,o):t.existsPuntoCtrl||t.isPuntoInteres?t.existsPuntoCtrl=t.isPuntoInteres=!1:t.nuevoPuntoControl(r,o)})),this.mapa.addControl(new i.NavigationControl),this.mapa.addControl(new i.FullscreenControl)}},{key:"nuevoPuntoControl",value:function(t,e){var n=this;u.a.fire({title:"Nuevo punto de control",text:"Ingresa el nombre del punto",input:"text",showCancelButton:!0,confirmButtonText:"Agregar",cancelButtonText:"Cancelar",cancelButtonColor:"#d33",inputValidator:function(t){if(!t)return"Necesitas escribir un nombre!"}}).then((function(r){if(r.value){n.puntosControl.push({longitud:t,latitud:e,nombre:r.value});var o=new i.Popup({offset:25}).setText(r.value),a=new i.Marker({color:"#d33"}).setPopup(o).setLngLat([t,e]).addTo(n.mapa);n.markersPtsControl.push(a),a._element.addEventListener("click",(function(){n.defineRuta?(n.isPuntoControl=!0,n.agregarCoordenada(t,e)):n.existsPuntoCtrl=!0}))}}))}},{key:"loadPuntosInteres",value:function(){return Object(a.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.verPtsInteres){t.next=6;break}return t.next=3,this.puntosIntService.getPuntosInteres();case 3:this.puntosInteres=t.sent,t.next=7;break;case 6:this.eliminarMarkers(),this.puntosInteres=[];case 7:this.mostrarPuntosInteres();case 8:case"end":return t.stop()}}),t,this)})))}},{key:"mostrarPuntosInteres",value:function(){var t=this;this.puntosInteres.forEach((function(e){var n=new i.Popup({offset:25}).setText(e.Descripcion),r=(new i.Marker).setPopup(n).setLngLat([e.Longitud,e.Latitud]).addTo(t.mapa);t.markersPtsInteres.push(r),r._element.addEventListener("click",(function(){t.defineRuta&&t.agregarCoordenada(e.Longitud,e.Latitud),t.isPuntoInteres=!0}))}))}},{key:"eliminarMarkers",value:function(){var t=this;this.markersPtsInteres.forEach((function(e,n){t.markersPtsInteres[n].remove()}))}},{key:"agregarCoordenada",value:function(t,e){this.geojson.features[0].geometry.coordinates.push([Number(t),Number(e)]),this.mapa.getSource("line").setData(this.geojson),this.buscarIdsPuntosInteres()}},{key:"limpiar",value:function(){var t=this;this.defineRuta?(this.geojson.features[0].geometry.coordinates=[],this.ptsInteresRuta=[],this.mapa.getSource("line").setData(this.geojson)):(this.puntosControl=[],this.markersPtsControl.forEach((function(e,n){t.markersPtsControl[n].remove()})),this.markersPtsControl=[])}},{key:"deshacer",value:function(){this.defineRuta?(this.geojson.features[0].geometry.coordinates.pop(),this.mapa.getSource("line").setData(this.geojson),this.buscarIdsPuntosInteres()):(this.puntosControl.pop(),this.markersPtsControl.length>0&&this.markersPtsControl[this.markersPtsControl.length-1].remove(),this.markersPtsControl.pop())}},{key:"buscarIdsPuntosInteres",value:function(){var t=this;this.ptsInteresRuta=[],this.coordenadas.forEach((function(e){var n=_slicedToArray(e,2),r=n[0],o=n[1],a=t.puntosInteres.find((function(t){return Number(t.Longitud)===r&&Number(t.Latitud)===o}));a&&(t.ptsInteresRuta.find((function(t){return t.Id===a.Id}))||t.ptsInteresRuta.push(a))}))}},{key:"onSubmit",value:function(t){return Object(a.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var n,r,o,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.valid){e.next=14;break}if(n=t.value,r=n.nombre,o=n.tiempoEst,!(this.coordenadas.length<3)){e.next=6;break}this.showErrorMessage("La ruta trazada es demasiado corta"),e.next=14;break;case 6:return a=this.geometryService.buildLineString(this.coordenadas),i={Nombre:r,PuntosInteres:JSON.stringify(this.ptsInteresRuta),PuntosControl:JSON.stringify(this.puntosControl),Ruta:a,RutaText:a,TiempoEstimado:o},e.next=9,this.recorridosService.nuevoRecorrido(i);case 9:if(!e.sent){e.next=13;break}this.router.navigateByUrl("/recorridos"),e.next=14;break;case 13:this.showErrorMessage("Ha ocurrido un error");case 14:case"end":return e.stop()}}),e,this)})))}},{key:"showErrorMessage",value:function(t){u.a.fire({icon:"error",text:t})}},{key:"getValidationClass",value:function(t){return t.untouched&&t.pristine?{}:{"is-valid":t.valid,"is-invalid":t.invalid}}},{key:"coordenadas",get:function(){return this.geojson.features[0].geometry.coordinates}}]),t}()).\u0275fac=function(t){return new(t||v)(l.Vb(d.a),l.Vb(b.a),l.Vb(m.a),l.Vb(o.b))},v.\u0275cmp=l.Pb({type:v,selectors:[["app-nuevo"]],decls:50,vars:10,consts:[[1,"row","justify-content-center"],[1,"col-md-12"],[1,"card","shadow"],["form1","ngForm"],[1,"card-header"],[1,"col-md-4","col-sm-10"],["routerLink","/recorridos",1,"mt-2","mr-1","btn","btn-sm","btn-light","shadow-sm"],[1,"fas","fa-arrow-left"],[1,"col-md-6","col-sm-10","my-2"],[1,"row"],[1,"col"],["type","text","name","nombre","required","","placeholder","Ingresa el nombre de la ruta",1,"form-control","form-control-sm",3,"ngModel","ngClass","ngModelChange"],["name","ngModel"],[1,"invalid-feedback"],[4,"ngIf"],[1,"input-group","input-group-sm"],["type","number","name","tiempoEst",1,"form-control","form-control-sm",3,"ngModel","ngClass","ngModelChange"],["tiempoEst","ngModel"],[1,"input-group-append"],[1,"input-group-text"],[1,"col-md-2","col-sm-10"],[1,"mt-2","btn","btn-block","btn-sm","btn-success",3,"disabled","click"],[1,"card-body","py-1"],[1,"col-md-4"],["role","group",1,"btn-group","mr-3"],["title","Trazar la ruta",1,"btn","btn-sm",3,"ngClass","click"],[1,"fas","fa-route"],["title","Puntos de control",1,"btn","btn-sm",3,"ngClass","click"],[1,"fas","fa-map-marker-alt"],["title","Puntos de inter\xe9s",1,"btn","btn-sm","btn-info",3,"click"],["class","fas fa-eye",4,"ngIf"],["class","fas fa-eye-slash",4,"ngIf"],[1,"col-md-4","text-center"],[1,"badge","badge-primary","mr-2"],[1,"badge","badge-danger"],[1,"float-right"],["title","Deshacer \xfaltimo cambio",1,"btn","btn-sm","btn-outline-warning","mr-2",3,"click"],[1,"fas","fa-undo"],["title","Limpiar mapa",1,"btn","btn-sm","btn-outline-danger","mr-2",3,"click"],[1,"fas","fa-eraser"],["id","map-recorrido"],[1,"fas","fa-eye"],[1,"fas","fa-eye-slash"]],template:function(t,e){if(1&t){var n=l.bc();l.ac(0,"div",0),l.ac(1,"div",1),l.ac(2,"div",2),l.ac(3,"form",null,3),l.ac(5,"div",4),l.ac(6,"div",0),l.ac(7,"div",5),l.ac(8,"button",6),l.Wb(9,"i",7),l.Zb(),l.Zb(),l.ac(10,"div",8),l.ac(11,"div",9),l.ac(12,"div",10),l.ac(13,"input",11,12),l.ic("ngModelChange",(function(t){return e.nombre=t})),l.Zb(),l.ac(15,"div",13),l.Bc(16,p,2,0,"span",14),l.Zb(),l.Zb(),l.ac(17,"div",10),l.ac(18,"div",15),l.ac(19,"input",16,17),l.ic("ngModelChange",(function(t){return e.tiempoEstimado=t})),l.Zb(),l.ac(21,"div",18),l.ac(22,"span",19),l.Dc(23,"Minutos"),l.Zb(),l.Zb(),l.Zb(),l.Zb(),l.Zb(),l.Zb(),l.ac(24,"div",20),l.ac(25,"button",21),l.ic("click",(function(){l.yc(n);var t=l.xc(4);return e.onSubmit(t)})),l.Dc(26," Guardar "),l.Zb(),l.Zb(),l.Zb(),l.Zb(),l.Zb(),l.ac(27,"div",22),l.ac(28,"div",9),l.ac(29,"div",23),l.ac(30,"div",24),l.ac(31,"button",25),l.ic("click",(function(){return e.defineRuta=!0})),l.Wb(32,"i",26),l.Zb(),l.ac(33,"button",27),l.ic("click",(function(){return e.defineRuta=!1})),l.Wb(34,"i",28),l.Zb(),l.Zb(),l.ac(35,"button",29),l.ic("click",(function(){return e.verPtsInteres=!e.verPtsInteres,e.loadPuntosInteres()})),l.Bc(36,h,1,0,"i",30),l.Bc(37,g,1,0,"i",31),l.Zb(),l.Zb(),l.ac(38,"div",32),l.ac(39,"span",33),l.Dc(40,"Punto de inter\xe9s"),l.Zb(),l.ac(41,"span",34),l.Dc(42,"Punto de control"),l.Zb(),l.Zb(),l.ac(43,"div",23),l.ac(44,"div",35),l.ac(45,"button",36),l.ic("click",(function(){return e.deshacer()})),l.Wb(46,"i",37),l.Zb(),l.ac(47,"button",38),l.ic("click",(function(){return e.limpiar()})),l.Wb(48,"i",39),l.Zb(),l.Zb(),l.Zb(),l.Zb(),l.Wb(49,"div",40),l.Zb(),l.Zb(),l.Zb(),l.Zb()}if(2&t){var r=l.xc(4),o=l.xc(14),a=l.xc(20);l.Jb(13),l.rc("ngModel",e.nombre)("ngClass",e.getValidationClass(o)),l.Jb(3),l.rc("ngIf",null==o.errors?null:o.errors.required),l.Jb(3),l.rc("ngModel",e.tiempoEstimado)("ngClass",e.getValidationClass(a)),l.Jb(6),l.rc("disabled",r.invalid),l.Jb(6),l.rc("ngClass",e.defineRuta?"btn-primary":"btn-outline-primary"),l.Jb(2),l.rc("ngClass",e.defineRuta?"btn-outline-primary":"btn-primary"),l.Jb(3),l.rc("ngIf",!e.verPtsInteres),l.Jb(1),l.rc("ngIf",e.verPtsInteres)}},directives:[f.s,f.h,f.i,o.c,f.a,f.o,f.g,f.j,r.k,r.m,f.l],styles:["#map-recorrido[_ngcontent-%COMP%]{margin-top:10px;width:100%;height:500px}"]}),v),k=n("j1ZV");n.d(e,"NuevoModule",(function(){return P}));var C,P=((C=function t(){_classCallCheck(this,t)}).\u0275mod=l.Tb({type:C}),C.\u0275inj=l.Sb({factory:function(t){return new(t||C)},imports:[[r.b,f.e,k.a,o.e.forChild([{path:"",component:y}])]]}),C)}}]);