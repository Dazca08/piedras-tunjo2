function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{aElb:function(e,t,n){"use strict";n.r(t);var r,i,o=n("ofXK"),s=n("mrSG"),a=n("4ZJM"),u=n("AytR"),c=n("PSD3"),l=n.n(c),f=n("fXoL"),d=n("cxbk"),p=n("tk/3"),h=n("LRne"),v=n("tyNb"),b=d.a.apiUrl,k=((i=function(){function e(t,n){_classCallCheck(this,e),this.http=t,this.router=n}return _createClass(e,[{key:"buildService",value:function(){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.token=localStorage.getItem("token")||void 0,this.token?(this.headers=new p.c({Authorization:"Bearer "+this.token}),!0):(this.router.navigateByUrl("/login"),!1)));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"getPuntosInteres",value:function(){return this.http.get("".concat(b,"/puntos-interes"))}},{key:"postPuntosInteres",value:function(e){return this.buildService().then((function(e){if(!e)return Object(h.a)({ok:!1})})),this.http.post("".concat(b,"/puntos-interes"),e,{headers:this.headers})}},{key:"putPuntosInteres",value:function(e){return this.buildService().then((function(e){if(!e)return Object(h.a)({ok:!1})})),this.http.put("".concat(b,"/puntos-interes/").concat(e.Id),e,{headers:this.headers})}},{key:"deletePuntosInteres",value:function(e){return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.buildService();case 2:if(!t.sent){t.next=6;break}t.t0=new Promise((function(t){n.http.delete("".concat(b,"/puntos-interes/").concat(e),{headers:n.headers}).subscribe((function(e){t(e.ok)}))})),t.next=7;break;case 6:t.t0=Promise.resolve(!1);case 7:return t.abrupt("return",t.t0);case 8:case"end":return t.stop()}}),t,this)})))}},{key:"existsPunto",value:function(e,t){var n=this;return new Promise((function(r){n.getPuntosInteres().subscribe((function(n){var i=n.find((function(n){return n.Longitud===e&&n.Latitud===t}));r(void 0!==i)}))}))}}]),e}()).\u0275fac=function(e){return new(e||i)(f.bc(p.a),f.bc(v.b))},i.\u0275prov=f.Ob({token:i,factory:i.\u0275fac,providedIn:"root"}),i),m=((r=function(){function e(t){_classCallCheck(this,e),this.puntosService=t,this.puntosInteres=[],this.currentMarkers=[]}return _createClass(e,[{key:"ngAfterViewInit",value:function(){var e=this;a.accessToken=u.a.mapboxToken,this.mapa=new a.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[-74.3451602,4.8154681],zoom:15}),this.mapa.on("load",(function(){e.loadPuntosInteres()})),this.mapa.on("click",(function(t){return Object(s.a)(e,void 0,void 0,regeneratorRuntime.mark((function e(){var n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.lngLat,r=n.lng,i=n.lat,this.processMarker(r,i);case 2:case"end":return e.stop()}}),e,this)})))}))}},{key:"ngOnInit",value:function(){}},{key:"loadPuntosInteres",value:function(){var e=this;l.a.fire({title:"Espere por favor",text:"Cargando informaci\xf3n",icon:"info",allowOutsideClick:!1}),l.a.showLoading(),this.puntosService.getPuntosInteres().subscribe((function(t){e.puntosInteres=t,e.addMarkersToMap(),l.a.close()}))}},{key:"addMarkersToMap",value:function(){var e=this;this.currentMarkers=[],this.puntosInteres.forEach((function(t){var n=(new a.Marker).setLngLat([t.Longitud,t.Latitud]).addTo(e.mapa);e.currentMarkers.push(n),n.getElement().addEventListener("click",(function(){setTimeout((function(){e.processMarker(t.Longitud,t.Latitud,t.Descripcion)}),10)})),n._element.addEventListener("mouseenter",(function(){n._element.style.cursor="pointer"}))}))}},{key:"processMarker",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return Object(s.a)(this,void 0,void 0,regeneratorRuntime.mark((function r(){var i=this;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:l.a.fire({title:(""===n?"Crear":"Modificar")+" punto de inter\xe9s",text:"Ingresa una descripci\xf3n",input:"text",inputValue:n,showCancelButton:""!==n,confirmButtonText:""===n?"Crear":"Actualizar",cancelButtonColor:"#d33",cancelButtonText:"Eliminar",showCloseButton:!0,inputValidator:function(e){if(!e)return"Necesitas escribir algo!"}}).then((function(r){if(r.value)if(""===n)i.puntosService.postPuntosInteres({Descripcion:r.value,Latitud:t,Longitud:e}).subscribe((function(e){!0===e.ok&&i.loadPuntosInteres()}));else{var o=i.puntosInteres.find((function(n){return n.Longitud===e&&n.Latitud===t}));o.Descripcion=r.value,i.puntosService.putPuntosInteres(o).subscribe((function(e){!0===e.ok&&i.loadPuntosInteres()}))}else if("cancel"===r.dismiss.toString()){var s=i.puntosInteres.find((function(n){return n.Longitud===e&&n.Latitud===t})).Id;i.openConfirmAlert(s)}}));case 1:case"end":return r.stop()}}),r)})))}},{key:"openConfirmAlert",value:function(e){var t=this;l.a.fire({title:"\xbfEst\xe1s seguro?",text:"No podr\xe1s revertir la acci\xf3n",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminar"}).then((function(n){return Object(s.a)(t,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=n.value,!t.t0){t.next=8;break}return this.eliminarCurrentMarkers(),t.next=5,this.puntosService.deletePuntosInteres(e);case 5:if(t.t1=t.sent,!t.t1){t.next=8;break}this.loadPuntosInteres();case 8:case"end":return t.stop()}}),t,this)})))}))}},{key:"eliminarCurrentMarkers",value:function(){for(var e=this.currentMarkers.length-1;e>=0;e--)this.currentMarkers[e]&&this.currentMarkers[e].remove()}}]),e}()).\u0275fac=function(e){return new(e||r)(f.Sb(k))},r.\u0275cmp=f.Mb({type:r,selectors:[["app-puntos-interes"]],decls:10,vars:0,consts:[["id","main-header",1,"py-2","bg-info","text-white"],[1,"container"],[1,"row"],[1,"col-md-6"],[1,"container","my-3"],["id","map"]],template:function(e,t){1&e&&(f.Xb(0,"header",0),f.Xb(1,"div",1),f.Xb(2,"div",2),f.Xb(3,"div",3),f.Xb(4,"h1"),f.uc(5," Puntos de interes "),f.Wb(),f.Wb(),f.Wb(),f.Wb(),f.Wb(),f.Tb(6,"br"),f.Tb(7,"br"),f.Xb(8,"div",4),f.Tb(9,"div",5),f.Wb())},styles:["#map[_ngcontent-%COMP%]{width:100%;height:500px}"]}),r),g=n("iTUp");n.d(t,"PuntosInteresModule",(function(){return y}));var w,y=((w=function e(){_classCallCheck(this,e)}).\u0275mod=f.Qb({type:w}),w.\u0275inj=f.Pb({factory:function(e){return new(e||w)},imports:[[o.b,g.a,v.d.forChild([{path:"",component:m}])]]}),w)}}]);