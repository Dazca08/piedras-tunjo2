(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{aElb:function(t,e,n){"use strict";n.r(e);var o=n("ofXK"),s=n("mrSG"),i=n("4ZJM"),r=n("AytR"),a=n("PSD3"),c=n.n(a),u=n("fXoL"),l=n("bJsm");let d=(()=>{class t{constructor(t){this.puntosService=t,this.puntosInteres=[],this.currentMarkers=[]}ngAfterViewInit(){i.accessToken=r.a.mapboxToken,this.mapa=new i.Map({container:"map-puntos-interes",style:"mapbox://styles/mapbox/streets-v11",center:[-74.3451602,4.8154681],zoom:15}),this.mapa.on("load",()=>{this.loadPuntosInteres()}),this.mapa.on("click",t=>Object(s.a)(this,void 0,void 0,(function*(){const{lng:e,lat:n}=t.lngLat;this.processMarker(e,n)}))),this.mapa.addControl(new i.NavigationControl),this.mapa.addControl(new i.FullscreenControl)}ngOnInit(){}loadPuntosInteres(){c.a.fire({title:"Espere por favor",text:"Cargando informaci\xf3n",icon:"info",allowOutsideClick:!1}),c.a.showLoading(),this.puntosService.getPuntosInteres().then(t=>{this.puntosInteres=t,this.addMarkersToMap(),c.a.close()})}addMarkersToMap(){this.currentMarkers=[],this.puntosInteres.forEach(t=>{const e=(new i.Marker).setLngLat([t.Longitud,t.Latitud]).addTo(this.mapa);this.currentMarkers.push(e),e.getElement().addEventListener("click",()=>{setTimeout(()=>{this.processMarker(t.Longitud,t.Latitud,t.Descripcion)},10)}),e._element.addEventListener("mouseenter",()=>{e._element.style.cursor="pointer"})})}processMarker(t,e,n=""){return Object(s.a)(this,void 0,void 0,(function*(){c.a.fire({title:(""===n?"CREAR":"MODIFICAR")+" PUNTO DE INTER\xc9S",text:"Ingresa una descripci\xf3n",input:"text",inputValue:n,showCancelButton:""!==n,confirmButtonText:""===n?"Crear":"Actualizar",cancelButtonColor:"#d33",cancelButtonText:"Eliminar",showCloseButton:!0,inputValidator:t=>{if(!t)return"Necesitas escribir algo!"}}).then(o=>Object(s.a)(this,void 0,void 0,(function*(){if(o.value){if(""===n){const n={Descripcion:o.value,Latitud:e,Longitud:t};yield this.puntosService.postPuntosInteres(n)}else{const n=this.puntosInteres.find(n=>n.Longitud===t&&n.Latitud===e);n.Descripcion=o.value,yield this.puntosService.putPuntosInteres(n)}setTimeout(()=>{this.loadPuntosInteres()},500)}else if("cancel"===o.dismiss.toString()){const{Id:n}=this.puntosInteres.find(n=>n.Longitud===t&&n.Latitud===e);this.openConfirmAlert(n)}})))}))}openConfirmAlert(t){c.a.fire({title:"\xbfEst\xe1s seguro?",text:"No podr\xe1s revertir la acci\xf3n",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, eliminar"}).then(e=>Object(s.a)(this,void 0,void 0,(function*(){e.value&&(yield this.puntosService.deletePuntosInteres(t))&&$("#form1").submit()})))}}return t.\u0275fac=function(e){return new(e||t)(u.Tb(l.a))},t.\u0275cmp=u.Nb({type:t,selectors:[["app-puntos-interes"]],decls:5,vars:0,consts:[[1,"text-muted","d-block","text-center"],["id","map-puntos-interes"],["id","form1"]],template:function(t,e){1&t&&(u.Yb(0,"b",0),u.zc(1,"PUNTOS DE INTER\xc9S"),u.Xb(),u.Ub(2,"hr"),u.Ub(3,"div",1),u.Ub(4,"form",2))},styles:["#map-puntos-interes[_ngcontent-%COMP%]{width:100%;height:450px}"]}),t})();var p=n("iTUp"),h=n("tyNb");n.d(e,"PuntosInteresModule",(function(){return m}));let m=(()=>{class t{}return t.\u0275mod=u.Rb({type:t}),t.\u0275inj=u.Qb({factory:function(e){return new(e||t)},imports:[[o.b,p.a,h.e.forChild([{path:"",component:d}])]]}),t})()}}]);